<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faizana Raza Madrassa - Result System</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Poppins:wght@300;400;500;600;700&family=Lateef:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a5f7a;
            --secondary: #2a9d8f;
            --accent: #ffd166;
            --light: #f8f9fa;
            --dark: #2d3436;
            --success: #38b000;
            --warning: #ffaa00;
            --danger: #e63946;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --shadow: 0 5px 15px rgba(0,0,0,0.1);
            --border-radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #f5f7fa; color: var(--dark); line-height: 1.6; }
        .arabic { font-family: 'Amiri', serif; direction: rtl; }
        .urdu { font-family: 'Lateef', serif; direction: rtl; font-size: 1.2rem; }
        .container { width: 95%; max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white; padding: 1rem 0; box-shadow: var(--shadow); position: relative; overflow: hidden;
        }
        .header::before, .header::after {
            content: "Ô∑Ω"; font-family: 'Amiri', serif; position: absolute; top: 50%; transform: translateY(-50%);
            font-size: 2.5rem; opacity: 0.15;
        }
        .header::before { right: 20px; }
        .header::after { left: 20px; }
        .logo-area { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 5px; flex-wrap: wrap; }
        .logo-icon { font-size: 2rem; color: var(--accent); }
        .madrassa-name { font-size: 1.5rem; font-weight: 700; text-align: center; }
        .madrassa-subtitle { font-size: 1rem; opacity: 0.9; text-align: center; font-weight: 300; }
        .sub-header { text-align: center; margin-top: 5px; font-size: 1rem; color: rgba(255,255,255,0.9); }
        
        /* Fixed Search Panel */
        .search-panel {
            background: white; padding: 1rem; border-radius: var(--border-radius); box-shadow: var(--shadow);
            margin: 1rem auto; max-width: 600px; position: sticky; top: 10px; z-index: 100;
        }
        .search-title { color: var(--primary); font-size: 1.3rem; margin-bottom: 1rem; text-align: center; }
        
        /* Main Content */
        .main-content { min-height: 70vh; padding: 1rem 0; }
        
        /* Cards */
        .card { background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 1.5rem; margin-bottom: 1rem; }
        .card-title { color: var(--primary); font-size: 1.4rem; margin-bottom: 1rem; text-align: center; }
        
        /* Forms */
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--dark); }
        .form-control { width: 100%; padding: 10px 12px; border: 2px solid #e1e5eb; border-radius: 8px; font-size: 1rem; }
        .form-control:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(26,95,122,0.2); }
        
        /* Buttons */
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-block { width: 100%; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #144c63; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        
        /* Result Display */
        .result-card { background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 1.5rem; margin-top: 1rem; }
        .student-header { background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; border-left: 5px solid var(--primary); }
        .student-info h3 { color: var(--primary); font-size: 1.3rem; margin-bottom: 0.3rem; }
        .position-badge { padding: 6px 15px; border-radius: 50px; font-weight: 700; }
        .position-1 { background: var(--gold); color: #856404; }
        .position-2 { background: var(--silver); color: #495057; }
        .position-3 { background: var(--bronze); color: white; }
        .marks-table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        .marks-table th { background: #f8f9fa; padding: 10px; text-align: left; color: var(--primary); font-weight: 600; }
        .marks-table td { padding: 10px; border-bottom: 1px solid #eee; }
        .total-section { background: #e7f5ff; padding: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .percentage { font-size: 1.5rem; font-weight: 700; color: var(--success); }
        .fine-notice { background: #fff3cd; border-left: 4px solid #ffc107; padding: 0.8rem; margin: 1rem 0; }
        .prayer-message { background: linear-gradient(to right, #2a9d8f, #1a5f7a); color: white; padding: 1rem; border-radius: 8px; text-align: center; margin-top: 1rem; font-weight: 600; }
        
        /* Flowers Animation */
        .flower-fall { position: relative; height: 100px; width: 100%; overflow: hidden; margin: 1rem 0; }
        .falling-flower { position: absolute; top: -30px; font-size: 1.5rem; animation: fall linear infinite; }
        @keyframes fall {
            0% { transform: translateY(-30px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(130px) rotate(360deg); opacity: 0; }
        }
        
        /* Admin Panel */
        .admin-panel { background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 1.5rem; margin: 1rem auto; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 2px solid #e1e5eb; flex-wrap: wrap; }
        .admin-title { color: var(--primary); font-size: 1.3rem; }
        .admin-tabs { display: flex; gap: 5px; margin-bottom: 1rem; flex-wrap: wrap; }
        .tab-btn { padding: 8px 12px; background: #f1f3f4; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-row { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 1rem; }
        .form-col { flex: 1; min-width: 150px; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9rem; }
        .data-table th { background: #f1f3f4; padding: 10px; text-align: left; color: var(--primary); }
        .data-table td { padding: 10px; border-bottom: 1px solid #eee; }
        .action-btn { padding: 4px 8px; margin: 0 2px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        
        /* Login Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-box { background: white; border-radius: var(--border-radius); padding: 1.5rem; width: 90%; max-width: 400px; }
        
        /* Student List */
        .student-list-container { max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 1rem; margin-top: 1rem; }
        .student-row { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; gap: 10px; flex-wrap: wrap; }
        .marks-input { width: 70px; padding: 6px; border: 2px solid #e1e5eb; border-radius: 5px; text-align: center; }
        .position-select { width: 100px; padding: 6px; border: 2px solid #e1e5eb; border-radius: 5px; }
        
        /* Utility */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .status-present { background: #d4edda; color: #155724; }
        .status-absent { background: #f8d7da; color: #721c24; }
        
        /* Footer */
        .footer { text-align: center; padding: 1rem; background: var(--dark); color: white; margin-top: 1rem; border-radius: var(--border-radius); }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { width: 100%; padding: 0 10px; }
            .madrassa-name { font-size: 1.3rem; }
            .card, .result-card { padding: 1rem; }
            .student-header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .form-row { flex-direction: column; }
            .admin-tabs { gap: 3px; }
            .tab-btn { padding: 6px 10px; font-size: 0.9rem; }
        }
        @media (max-width: 480px) {
            .header::before, .header::after { font-size: 1.8rem; }
            .btn { padding: 8px 12px; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo-area">
                <i class="fas fa-mosque logo-icon"></i>
                <div>
                    <h1 class="madrassa-name">Faizana Raza Madrassa</h1>
                    <p class="madrassa-subtitle">Islamic Education & Quran Learning Center</p>
                </div>
            </div>
            <p class="sub-header urdu">ŸÜŸàÿ±ÿßŸÜ€å ŸÇÿßÿπÿØ€Å ÿßŸàÿ± ÿ≥Ÿæÿßÿ±€Å ⁄©ŸÑÿßÿ≥ÿ≤ ⁄©ÿß ÿ±ÿ≤ŸÑŸπ ⁄Ü€å⁄© ⁄©ÿ±ŸÜ€í ⁄©ÿß ŸæŸàÿ±ŸπŸÑ</p>
        </div>
    </header>
    
    <!-- Fixed Search Panel -->
    <div class="container">
        <div class="search-panel">
            <h2 class="search-title">Check Student Result</h2>
            <div class="form-group">
                <label for="rollNumber" class="form-label">Enter Roll Number</label>
                <div class="form-row">
                    <div class="form-col">
                        <input type="text" id="rollNumber" class="form-control" placeholder="Enter roll number">
                    </div>
                    <div class="form-col">
                        <button id="checkResultBtn" class="btn btn-primary btn-block">
                            <i class="fas fa-search"></i> Check Result
                        </button>
                    </div>
                </div>
            </div>
            <div class="text-center mt-2">
                <small class="text-muted">For admin access, click <a href="#" id="adminLoginLink">here</a></small>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="container">
        <div class="main-content">
            <!-- Result Display -->
            <div id="resultSection" class="result-card hidden">
                <div id="flowerFall" class="flower-fall hidden"></div>
                
                <div class="student-header">
                    <div class="student-info">
                        <h3 id="studentName">Student Name</h3>
                        <p>Roll No: <span id="resultRollNo">-</span> | Class: <span id="studentClass">-</span></p>
                        <p id="examDate">Exam Date: June 2024</p>
                        <p id="studentStatus" class="status-badge status-present">Status: Present</p>
                    </div>
                    <div class="position-badge" id="positionBadge">Position: -</div>
                </div>
                
                <table class="marks-table">
                    <thead><tr><th>Subject</th><th>Total</th><th>Obtained</th></tr></thead>
                    <tbody id="marksTableBody"></tbody>
                </table>
                
                <div class="total-section">
                    <div><h4>Total Marks</h4><p>Obtained: <span id="obtainedMarks">0</span>/<span id="totalMarks">100</span></p></div>
                    <div class="percentage" id="percentage">0%</div>
                </div>
                
                <div id="fineSection" class="fine-notice hidden">
                    <strong><i class="fas fa-exclamation-circle"></i> Fine Notice:</strong>
                    <span id="fineAmount">A fine is due.</span>
                </div>
                
                <div class="prayer-message urdu">ŸÜŸÖÿßÿ≤ ⁄©€å Ÿæÿßÿ®ŸÜÿØ€å ÿ±⁄©⁄æ€å⁄∫€î</div>
            </div>
            
            <!-- Loading & Error -->
            <div id="loadingSpinner" class="hidden text-center"><div class="spinner"></div><p class="mt-2">Loading...</p></div>
            <div id="errorMessage" class="hidden"><div class="alert alert-danger"><i class="fas fa-exclamation-triangle"></i> <span id="errorText"></span></div></div>
        </div>
        
        <!-- Admin Login Modal -->
        <div id="adminLoginModal" class="modal-overlay hidden">
            <div class="modal-box">
                <h2 class="card-title mb-3">Admin Login</h2>
                <div class="form-group">
                    <input type="password" id="adminPassword" class="form-control" placeholder="Enter admin password">
                </div>
                <div class="form-group">
                    <button id="loginBtn" class="btn btn-primary btn-block">Login</button>
                    <button id="cancelLoginBtn" class="btn btn-secondary btn-block mt-2">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel hidden">
            <div class="admin-header">
                <h2 class="admin-title"><i class="fas fa-user-shield"></i> Admin Panel</h2>
                <button id="logoutBtn" class="btn btn-danger">Logout</button>
            </div>
            
            <div class="admin-tabs">
                <button class="tab-btn active" data-tab="examSetup">Exam Setup</button>
                <button class="tab-btn" data-tab="subjects">Subjects</button>
                <button class="tab-btn" data-tab="addStudents">Add Students</button>
                <button class="tab-btn" data-tab="enterMarks">Enter Marks</button>
                <button class="tab-btn" data-tab="manageFines">Manage Fines</button>
                <button class="tab-btn" data-tab="deleteData">Delete Data</button>
                <button class="tab-btn" data-tab="changePassword">Change Password</button>
                <button class="tab-btn" data-tab="viewResults">View Results</button>
            </div>
            
            <!-- Exam Setup -->
            <div id="examSetup" class="tab-content active">
                <h3 class="card-title">Exam Date Setup</h3>
                <div class="form-group">
                    <label class="form-label">Exam Date</label>
                    <input type="date" id="examDateInput" class="form-control" value="2024-06-15">
                </div>
                <button id="saveExamDateBtn" class="btn btn-success">Save Exam Date</button>
            </div>
            
            <!-- Subjects -->
            <div id="subjects" class="tab-content">
                <h3 class="card-title">Manage Subjects</h3>
                <div id="subjectInputs">
                    <div class="form-row subject-row">
                        <div class="form-col"><input type="text" class="form-control subject-name" placeholder="Subject Name" value="Quran Recitation"></div>
                        <div class="form-col"><input type="number" class="form-control subject-total" placeholder="Total Marks" value="50"></div>
                        <div class="form-col"><button class="btn btn-danger remove-subject-btn"><i class="fas fa-times"></i></button></div>
                    </div>
                </div>
                <button id="addSubjectBtn" class="btn btn-secondary mt-2">Add Subject</button>
                <button id="saveSubjectsBtn" class="btn btn-success mt-2">Save Subjects</button>
            </div>
            
            <!-- Add Students -->
            <div id="addStudents" class="tab-content">
                <h3 class="card-title">Add Students</h3>
                <div class="form-row">
                    <div class="form-col">
                        <input type="text" id="addRollNo" class="form-control" placeholder="Roll Number">
                    </div>
                    <div class="form-col">
                        <input type="text" id="addName" class="form-control" placeholder="Student Name">
                    </div>
                    <div class="form-col">
                        <select id="addClass" class="form-control">
                            <option value="Separa">Separa</option>
                            <option value="Noorani Qayda">Noorani Qayda</option>
                        </select>
                    </div>
                </div>
                <button id="saveStudentBtn" class="btn btn-success mt-2">Save Student</button>
                <button id="addSampleStudentsBtn" class="btn btn-primary mt-2">Add All Sample Students</button>
            </div>
            
            <!-- Enter Marks -->
            <div id="enterMarks" class="tab-content">
                <h3 class="card-title">Enter Marks & Positions</h3>
                <select id="marksClass" class="form-control mb-3">
                    <option value="all">All Classes</option>
                    <option value="Separa">Separa</option>
                    <option value="Noorani Qayda">Noorani Qayda</option>
                </select>
                <div id="marksEntryContainer" class="student-list-container"></div>
                <button id="saveAllMarksBtn" class="btn btn-success mt-3">Save All Marks & Positions</button>
            </div>
            
            <!-- Manage Fines -->
            <div id="manageFines" class="tab-content">
                <h3 class="card-title">Manage Fines</h3>
                <div class="form-row">
                    <div class="form-col">
                        <input type="text" id="fineSearchRoll" class="form-control" placeholder="Search Roll No">
                    </div>
                    <div class="form-col">
                        <button id="searchFineBtn" class="btn btn-primary">Search</button>
                    </div>
                </div>
                <div id="fineManageSection" class="hidden mt-3">
                    <div class="form-row">
                        <div class="form-col">
                            <input type="number" id="fineAmountInput" class="form-control" placeholder="Fine Amount">
                        </div>
                        <div class="form-col">
                            <input type="text" id="fineReason" class="form-control" placeholder="Reason">
                        </div>
                    </div>
                    <button id="assignFineBtn" class="btn btn-warning">Assign Fine</button>
                    <button id="clearFineBtn" class="btn btn-danger">Clear Fine</button>
                    <button id="markPaidBtn" class="btn btn-success">Mark as Paid</button>
                </div>
            </div>
            
            <!-- Delete Data -->
            <div id="deleteData" class="tab-content">
                <h3 class="card-title">Delete Data</h3>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Warning:</strong> Deleted data cannot be recovered!
                </div>
                
                <div class="form-group mt-3">
                    <label class="form-label">Delete Single Student</label>
                    <div class="form-row">
                        <div class="form-col">
                            <input type="text" id="deleteRollNo" class="form-control" placeholder="Enter Roll Number">
                        </div>
                        <div class="form-col">
                            <button id="deleteStudentBtn" class="btn btn-danger btn-block">Delete Student</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-3">
                    <label class="form-label">Delete All Data from Firebase</label>
                    <div class="alert alert-danger">
                        <i class="fas fa-skull-crossbones"></i>
                        <strong>DANGER:</strong> This will delete ALL students, subjects, and settings!
                    </div>
                    <button id="deleteAllDataBtn" class="btn btn-danger btn-block">
                        <i class="fas fa-trash"></i> Delete ALL Data from Firebase
                    </button>
                </div>
                
                <div class="form-group mt-3">
                    <label class="form-label">View All Students for Deletion</label>
                    <select id="deleteStudentSelect" class="form-control">
                        <option value="">Select student to delete</option>
                    </select>
                    <button id="deleteSelectedBtn" class="btn btn-danger mt-2">Delete Selected Student</button>
                </div>
            </div>
            
            <!-- Change Password -->
            <div id="changePassword" class="tab-content">
                <h3 class="card-title">Change Admin Password</h3>
                <div class="alert alert-info">
                    <i class="fas fa-key"></i>
                    <strong>Note:</strong> Enter previous password to set new password
                </div>
                
                <div class="form-group">
                    <label class="form-label">Previous Password</label>
                    <input type="password" id="prevPassword" class="form-control" placeholder="Enter current password">
                </div>
                
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <input type="password" id="newPassword" class="form-control" placeholder="Enter new password">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm New Password</label>
                    <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm new password">
                </div>
                
                <button id="changePasswordBtn" class="btn btn-success">Change Password</button>
                
                <div class="mt-3">
                    <div class="alert alert-light">
                        <strong>Current Password Code:</strong>
                        <code id="currentPasswordCode" class="d-block mt-2">admin123</code>
                        <small class="text-muted">Copy this code to change password</small>
                    </div>
                </div>
            </div>
            
            <!-- View Results -->
            <div id="viewResults" class="tab-content">
                <h3 class="card-title">View All Results</h3>
                <select id="filterClass" class="form-control mb-3">
                    <option value="all">All Classes</option>
                    <option value="Separa">Separa</option>
                    <option value="Noorani Qayda">Noorani Qayda</option>
                </select>
                <table class="data-table">
                    <thead><tr><th>Pos</th><th>Roll</th><th>Name</th><th>Class</th><th>Marks</th><th>Status</th><th>Fine</th><th>View</th><th>Delete</th></tr></thead>
                    <tbody id="allResultsTable"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="arabic">ÿ±Ÿéÿ®ŸêŸë ÿ≤ŸêÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖŸãÿß</p>
            <p>"My Lord, increase me in knowledge." (Quran 20:114)</p>
            <p>&copy; 2024 Faizana Raza Madrassa</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDp8fdbDJRs17iFgcj1lN1YAmhiWccEkuc",
            authDomain: "result-app-8cdd1.firebaseapp.com",
            databaseURL: "https://result-app-8cdd1-default-rtdb.firebaseio.com",
            projectId: "result-app-8cdd1",
            storageBucket: "result-app-8cdd1.firebasestorage.app",
            messagingSenderId: "1000820695282",
            appId: "1:1000820695282:web:82a4f0ee1e51de2305f06b"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Default admin password (will be loaded from Firebase)
        let currentAdminPassword = "admin123";
        
        // DOM Elements
        const searchPanel = document.querySelector('.search-panel');
        const resultSection = document.getElementById('resultSection');
        const adminPanel = document.getElementById('adminPanel');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const rollNumberInput = document.getElementById('rollNumber');
        const checkResultBtn = document.getElementById('checkResultBtn');
        const adminLoginLink = document.getElementById('adminLoginLink');
        const adminPasswordInput = document.getElementById('adminPassword');
        const loginBtn = document.getElementById('loginBtn');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        
        // Current State
        let currentStudentRollNo = null;
        let subjects = [];
        let isAdminLoggedIn = false;
        
        // Initialize
        function initApp() {
            loadAdminPassword();
            loadSubjects();
            loadExamDate();
            
            // Event Listeners
            checkResultBtn.addEventListener('click', checkResult);
            adminLoginLink.addEventListener('click', showAdminLogin);
            loginBtn.addEventListener('click', handleAdminLogin);
            cancelLoginBtn.addEventListener('click', hideAdminLogin);
            logoutBtn.addEventListener('click', handleLogout);
            
            // Admin Tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.getAttribute('data-tab')));
            });
            
            // Exam Setup
            document.getElementById('saveExamDateBtn').addEventListener('click', saveExamDate);
            
            // Subjects
            document.getElementById('addSubjectBtn').addEventListener('click', addSubjectField);
            document.getElementById('saveSubjectsBtn').addEventListener('click', saveSubjects);
            
            // Students
            document.getElementById('saveStudentBtn').addEventListener('click', saveStudent);
            document.getElementById('addSampleStudentsBtn').addEventListener('click', addSampleStudents);
            
            // Marks
            document.getElementById('marksClass').addEventListener('change', loadStudentsForMarks);
            document.getElementById('saveAllMarksBtn').addEventListener('click', saveAllMarks);
            
            // Fines
            document.getElementById('searchFineBtn').addEventListener('click', searchFine);
            document.getElementById('assignFineBtn').addEventListener('click', assignFine);
            document.getElementById('clearFineBtn').addEventListener('click', clearFine);
            document.getElementById('markPaidBtn').addEventListener('click', markFinePaidAdmin);
            
            // Delete Data
            document.getElementById('deleteStudentBtn').addEventListener('click', deleteStudent);
            document.getElementById('deleteAllDataBtn').addEventListener('click', confirmDeleteAllData);
            document.getElementById('deleteSelectedBtn').addEventListener('click', deleteSelectedStudent);
            
            // Change Password
            document.getElementById('changePasswordBtn').addEventListener('click', changeAdminPassword);
            
            // Results
            document.getElementById('filterClass').addEventListener('change', loadAllResults);
            
            // Enter key for roll number
            rollNumberInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkResult(); });
            adminPasswordInput.addEventListener('keypress', e => { if(e.key === 'Enter') handleAdminLogin(); });
            
            if(localStorage.getItem('adminLoggedIn') === 'true') {
                isAdminLoggedIn = true;
                showAdminPanel();
            }
            
            checkAndAddSampleData();
        }
        
        // Load Admin Password from Firebase
        function loadAdminPassword() {
            database.ref('adminPassword').once('value').then(snapshot => {
                if(snapshot.exists()) {
                    currentAdminPassword = snapshot.val();
                } else {
                    // Set default password if not exists
                    database.ref('adminPassword').set(currentAdminPassword);
                }
                // Update display
                document.getElementById('currentPasswordCode').textContent = currentAdminPassword;
            });
        }
        
        // Load Subjects
        function loadSubjects() {
            database.ref('subjects').once('value').then(snapshot => {
                subjects = snapshot.val() || [];
                if(subjects.length === 0) {
                    subjects = [{name: "Quran Recitation", total: 50}];
                    database.ref('subjects').set(subjects);
                }
                updateSubjectInputs();
            });
        }
        
        function updateSubjectInputs() {
            const container = document.getElementById('subjectInputs');
            container.innerHTML = '';
            subjects.forEach((subject, index) => {
                const div = document.createElement('div');
                div.className = 'form-row subject-row mt-2';
                div.innerHTML = `
                    <div class="form-col"><input type="text" class="form-control subject-name" value="${subject.name}" placeholder="Subject Name"></div>
                    <div class="form-col"><input type="number" class="form-control subject-total" value="${subject.total}" placeholder="Total Marks"></div>
                    <div class="form-col"><button class="btn btn-danger remove-subject-btn"><i class="fas fa-times"></i></button></div>
                `;
                container.appendChild(div);
                div.querySelector('.remove-subject-btn').addEventListener('click', () => {
                    subjects.splice(index, 1);
                    updateSubjectInputs();
                });
            });
        }
        
        // Load Exam Date
        function loadExamDate() {
            database.ref('examDate').once('value').then(snapshot => {
                if(snapshot.exists()) {
                    document.getElementById('examDateInput').value = snapshot.val();
                }
            });
        }
        
        // Check Result
        function checkResult() {
            const rollNo = rollNumberInput.value.trim();
            if(!rollNo) return showError("Please enter roll number");
            
            showLoading(true);
            database.ref(`students/${rollNo}`).once('value').then(snapshot => {
                showLoading(false);
                if(!snapshot.exists()) {
                    showError("Student not found");
                    return;
                }
                
                currentStudentRollNo = rollNo;
                const student = snapshot.val();
                displayResult(student, rollNo);
            }).catch(error => {
                showLoading(false);
                showError("Error: " + error.message);
            });
        }
        
        // Display Result - MODIFIED: No pay button in result view
        function displayResult(student, rollNo) {
            resultSection.classList.remove('hidden');
            
            // Student Info
            document.getElementById('studentName').textContent = student.name;
            document.getElementById('resultRollNo').textContent = rollNo;
            document.getElementById('studentClass').textContent = student.class;
            
            // Exam Date
            database.ref('examDate').once('value').then(snapshot => {
                if(snapshot.exists()) {
                    document.getElementById('examDate').textContent = `Exam Date: ${snapshot.val()}`;
                }
            });
            
            // Status & Position
            const hasMarks = student.marks && student.marks.some(m => m > 0);
            const isAbsent = student.status === 'absent' || !hasMarks;
            
            const statusEl = document.getElementById('studentStatus');
            if(isAbsent) {
                statusEl.textContent = 'Status: Absent';
                statusEl.className = 'status-badge status-absent';
            } else {
                statusEl.textContent = 'Status: Present';
                statusEl.className = 'status-badge status-present';
            }
            
            const position = student.position || 0;
            const positionBadge = document.getElementById('positionBadge');
            if(position === 1) {
                positionBadge.textContent = 'ü•á 1st Position';
                positionBadge.className = 'position-badge position-1';
                startFlowerAnimation();
            } else if(position === 2) {
                positionBadge.textContent = 'ü•à 2nd Position';
                positionBadge.className = 'position-badge position-2';
                startFlowerAnimation();
            } else if(position === 3) {
                positionBadge.textContent = 'ü•â 3rd Position';
                positionBadge.className = 'position-badge position-3';
                startFlowerAnimation();
            } else {
                positionBadge.textContent = 'Position: -';
                positionBadge.className = 'position-badge';
            }
            
            // Marks Table
            const marksBody = document.getElementById('marksTableBody');
            marksBody.innerHTML = '';
            let totalObtained = 0, totalMaximum = 0;
            
            if(isAbsent) {
                marksBody.innerHTML = '<tr><td colspan="3" class="text-center">Student was absent</td></tr>';
            } else if(subjects.length > 0) {
                subjects.forEach((subject, index) => {
                    const mark = student.marks && student.marks[index] ? student.marks[index] : 0;
                    const row = `<tr><td>${subject.name}</td><td>${subject.total}</td><td>${mark}</td></tr>`;
                    marksBody.innerHTML += row;
                    totalObtained += parseInt(mark) || 0;
                    totalMaximum += subject.total;
                });
            }
            
            // Totals
            document.getElementById('obtainedMarks').textContent = totalObtained;
            document.getElementById('totalMarks').textContent = totalMaximum;
            document.getElementById('percentage').textContent = totalMaximum > 0 ? `${((totalObtained/totalMaximum)*100).toFixed(2)}%` : '0%';
            
            // Fine Section - MODIFIED: Read-only, no pay button
            const fineSection = document.getElementById('fineSection');
            if(student.fine && student.fine.amount > 0) {
                const paid = student.fine.paid || false;
                document.getElementById('fineAmount').textContent = 
                    `Fine: Rs. ${student.fine.amount} (${student.fine.reason}) - ${paid ? 'Paid' : 'Unpaid'}`;
                fineSection.classList.remove('hidden');
            } else {
                fineSection.classList.add('hidden');
            }
        }
        
        // Flower Animation
        function startFlowerAnimation() {
            const container = document.getElementById('flowerFall');
            container.innerHTML = '';
            container.classList.remove('hidden');
            for(let i=0; i<10; i++) {
                const flower = document.createElement('div');
                flower.className = 'falling-flower';
                flower.textContent = 'üíê';
                flower.style.left = `${Math.random()*100}%`;
                flower.style.animationDuration = `${2+Math.random()*3}s`;
                flower.style.animationDelay = `${Math.random()*2}s`;
                container.appendChild(flower);
            }
        }
        
        // Admin Functions
        function showAdminLogin() {
            adminLoginModal.classList.remove('hidden');
            adminPasswordInput.focus();
        }
        
        function hideAdminLogin() {
            adminLoginModal.classList.add('hidden');
            adminPasswordInput.value = '';
        }
        
        function handleAdminLogin() {
            if(adminPasswordInput.value === currentAdminPassword) {
                isAdminLoggedIn = true;
                localStorage.setItem('adminLoggedIn', 'true');
                hideAdminLogin();
                showAdminPanel();
            } else {
                showError("Invalid password");
            }
        }
        
        function showAdminPanel() {
            adminPanel.classList.remove('hidden');
            loadStudentsForMarks();
            loadAllResults();
            loadDeleteStudentDropdown();
        }
        
        function handleLogout() {
            isAdminLoggedIn = false;
            localStorage.removeItem('adminLoggedIn');
            adminPanel.classList.add('hidden');
        }
        
        // Tab Switching
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            if(tabId === 'deleteData') {
                loadDeleteStudentDropdown();
            }
        }
        
        // Exam Date
        function saveExamDate() {
            const date = document.getElementById('examDateInput').value;
            database.ref('examDate').set(date);
            showSuccess("Exam date saved");
        }
        
        // Subjects Management
        function addSubjectField() {
            const div = document.createElement('div');
            div.className = 'form-row subject-row mt-2';
            div.innerHTML = `
                <div class="form-col"><input type="text" class="form-control subject-name" placeholder="Subject Name"></div>
                <div class="form-col"><input type="number" class="form-control subject-total" placeholder="Total Marks"></div>
                <div class="form-col"><button class="btn btn-danger remove-subject-btn"><i class="fas fa-times"></i></button></div>
            `;
            document.getElementById('subjectInputs').appendChild(div);
            div.querySelector('.remove-subject-btn').addEventListener('click', () => {
                const index = Array.from(document.querySelectorAll('.subject-row')).indexOf(div);
                subjects.splice(index, 1);
                updateSubjectInputs();
            });
        }
        
        function saveSubjects() {
            const rows = document.querySelectorAll('.subject-row');
            const newSubjects = [];
            rows.forEach(row => {
                const name = row.querySelector('.subject-name').value.trim();
                const total = parseInt(row.querySelector('.subject-total').value) || 0;
                if(name && total > 0) newSubjects.push({name, total});
            });
            if(newSubjects.length === 0) return showError("Add at least one subject");
            database.ref('subjects').set(newSubjects).then(() => {
                subjects = newSubjects;
                showSuccess("Subjects saved");
            });
        }
        
        // Add Student
        function saveStudent() {
            const rollNo = document.getElementById('addRollNo').value.trim();
            const name = document.getElementById('addName').value.trim();
            const cls = document.getElementById('addClass').value;
            
            if(!rollNo || !name) return showError("Enter roll number and name");
            
            const student = {
                rollNo, name, class: cls,
                position: 0, status: 'present',
                fine: {amount: 0, reason: "", paid: false},
                marks: [], createdAt: new Date().toISOString()
            };
            
            database.ref(`students/${rollNo}`).set(student).then(() => {
                showSuccess("Student added");
                document.getElementById('addRollNo').value = '';
                document.getElementById('addName').value = '';
                loadStudentsForMarks();
                loadDeleteStudentDropdown();
            });
        }
        
        // Add Sample Students
        function addSampleStudents() {
            const sampleStudents = {
                "1": {name: "Abdullah", class: "Separa"},
                "2": {name: "Ayesha", class: "Separa"},
                "3": {name: "Farwa", class: "Separa"},
                "4": {name: "Rahan", class: "Separa"},
                "5": {name: "Saniya", class: "Separa"},
                "6": {name: "Arooj", class: "Separa"},
                "7": {name: "Munaza", class: "Separa"},
                "8": {name: "Anees", class: "Separa"},
                "9": {name: "Saad-ullah", class: "Separa"},
                "10": {name: "Asad-ullah", class: "Separa"},
                "11": {name: "Amna", class: "Separa"},
                "12": {name: "Farwa J.", class: "Separa"},
                "13": {name: "Maryam", class: "Separa"},
                "14": {name: "Muqadas", class: "Separa"},
                "15": {name: "Javairia", class: "Separa"},
                "01": {name: "Nimra", class: "Noorani Qayda"},
                "02": {name: "Faizan", class: "Noorani Qayda"},
                "03": {name: "Mustansira", class: "Noorani Qayda"},
                "04": {name: "Ali Hassan", class: "Noorani Qayda"},
                "05": {name: "Habiba", class: "Noorani Qayda"},
                "06": {name: "Usman", class: "Noorani Qayda"},
                "07": {name: "Mera", class: "Noorani Qayda"},
                "010": {name: "Saliha", class: "Noorani Qayda"},
                "011": {name: "Ahmad Shah", class: "Noorani Qayda"},
                "012": {name: "Ayesha", class: "Noorani Qayda"},
                "013": {name: "Hadiya", class: "Noorani Qayda"},
                "014": {name: "Hassan", class: "Noorani Qayda"},
                "015": {name: "Hashim", class: "Noorani Qayda"}
            };
            
            let updates = {};
            Object.keys(sampleStudents).forEach(rollNo => {
                updates[`students/${rollNo}`] = {
                    ...sampleStudents[rollNo],
                    position: 0,
                    status: 'present',
                    fine: {amount: 0, reason: "", paid: false},
                    marks: [],
                    createdAt: new Date().toISOString()
                };
            });
            
            database.ref().update(updates).then(() => {
                showSuccess("All sample students added");
                loadStudentsForMarks();
                loadDeleteStudentDropdown();
            });
        }
        
        // Load Students for Marks Entry
        function loadStudentsForMarks() {
            const selectedClass = document.getElementById('marksClass').value;
            const container = document.getElementById('marksEntryContainer');
            container.innerHTML = '<p>Loading students...</p>';
            
            database.ref('students').once('value').then(snapshot => {
                const students = snapshot.val() || {};
                container.innerHTML = '';
                
                Object.keys(students).forEach(rollNo => {
                    const student = students[rollNo];
                    if(selectedClass !== 'all' && student.class !== selectedClass) return;
                    
                    const row = document.createElement('div');
                    row.className = 'student-row';
                    
                    let marksHTML = '';
                    subjects.forEach((subject, index) => {
                        const mark = student.marks && student.marks[index] ? student.marks[index] : '';
                        marksHTML += `
                            <div class="form-col">
                                <input type="number" class="marks-input" data-roll="${rollNo}" data-index="${index}" 
                                       max="${subject.total}" placeholder="${subject.name}" value="${mark}">
                            </div>
                        `;
                    });
                    
                    row.innerHTML = `
                        <div style="flex:1; min-width:150px;">
                            <strong>${rollNo} - ${student.name}</strong><br>
                            <small>${student.class}</small>
                        </div>
                        <div class="form-row" style="flex:2;">${marksHTML}</div>
                        <div class="form-col">
                            <select class="position-select" data-roll="${rollNo}">
                                <option value="0">No Position</option>
                                <option value="1" ${student.position==1?'selected':''}>1st</option>
                                <option value="2" ${student.position==2?'selected':''}>2nd</option>
                                <option value="3" ${student.position==3?'selected':''}>3rd</option>
                            </select>
                        </div>
                    `;
                    container.appendChild(row);
                });
            });
        }
        
        // Save All Marks
        function saveAllMarks() {
            const marksInputs = document.querySelectorAll('.marks-input');
            const positionSelects = document.querySelectorAll('.position-select');
            
            let updates = {};
            let positionCount = {1:0,2:0,3:0};
            
            // Count positions
            positionSelects.forEach(select => {
                const pos = parseInt(select.value);
                if(pos > 0) positionCount[pos]++;
            });
            
            // Validate only 3 positions
            if(positionCount[1] > 1 || positionCount[2] > 1 || positionCount[3] > 1) {
                return showError("Only one student per position (1st, 2nd, 3rd) allowed");
            }
            
            // Process marks
            marksInputs.forEach(input => {
                const rollNo = input.getAttribute('data-roll');
                const index = parseInt(input.getAttribute('data-index'));
                const mark = input.value.trim();
                
                if(!updates[`students/${rollNo}/marks`]) {
                    updates[`students/${rollNo}/marks`] = [];
                }
                updates[`students/${rollNo}/marks`][index] = mark === '' ? 0 : parseInt(mark);
                
                // Auto absent if all marks are 0 or empty
                const allMarks = Array.from(document.querySelectorAll(`.marks-input[data-roll="${rollNo}"]`));
                const hasMarks = allMarks.some(m => m.value.trim() !== '' && parseInt(m.value) > 0);
                updates[`students/${rollNo}/status`] = hasMarks ? 'present' : 'absent';
            });
            
            // Process positions
            positionSelects.forEach(select => {
                const rollNo = select.getAttribute('data-roll');
                updates[`students/${rollNo}/position`] = parseInt(select.value);
            });
            
            database.ref().update(updates).then(() => {
                showSuccess("All marks and positions saved");
            });
        }
        
        // Fine Management
        function searchFine() {
            const rollNo = document.getElementById('fineSearchRoll').value.trim();
            if(!rollNo) return showError("Enter roll number");
            
            database.ref(`students/${rollNo}`).once('value').then(snapshot => {
                if(!snapshot.exists()) {
                    showError("Student not found");
                    return;
                }
                
                const student = snapshot.val();
                document.getElementById('fineManageSection').classList.remove('hidden');
                document.getElementById('fineAmountInput').value = student.fine?.amount || '';
                document.getElementById('fineReason').value = student.fine?.reason || '';
            });
        }
        
        function assignFine() {
            const rollNo = document.getElementById('fineSearchRoll').value.trim();
            const amount = parseInt(document.getElementById('fineAmountInput').value) || 0;
            const reason = document.getElementById('fineReason').value.trim();
            
            if(!rollNo || amount <= 0) return showError("Enter valid amount");
            
            const fine = {amount, reason: reason || "Fine", paid: false};
            database.ref(`students/${rollNo}/fine`).set(fine).then(() => {
                showSuccess("Fine assigned");
            });
        }
        
        function clearFine() {
            const rollNo = document.getElementById('fineSearchRoll').value.trim();
            if(!rollNo) return showError("Enter roll number");
            
            const fine = {amount: 0, reason: "", paid: false};
            database.ref(`students/${rollNo}/fine`).set(fine).then(() => {
                showSuccess("Fine cleared");
            });
        }
        
        function markFinePaidAdmin() {
            const rollNo = document.getElementById('fineSearchRoll').value.trim();
            if(!rollNo) return showError("Enter roll number");
            
            database.ref(`students/${rollNo}/fine`).once('value').then(snapshot => {
                if(snapshot.exists()) {
                    const fine = snapshot.val();
                    fine.paid = true;
                    database.ref(`students/${rollNo}/fine`).set(fine).then(() => {
                        showSuccess("Fine marked as paid");
                    });
                }
            });
        }
        
        // Delete Functions
        function loadDeleteStudentDropdown() {
            const select = document.getElementById('deleteStudentSelect');
            select.innerHTML = '<option value="">Select student to delete</option>';
            
            database.ref('students').once('value').then(snapshot => {
                const students = snapshot.val() || {};
                Object.keys(students).forEach(rollNo => {
                    const student = students[rollNo];
                    const option = document.createElement('option');
                    option.value = rollNo;
                    option.textContent = `${rollNo} - ${student.name} (${student.class})`;
                    select.appendChild(option);
                });
            });
        }
        
        function deleteStudent() {
            const rollNo = document.getElementById('deleteRollNo').value.trim();
            if(!rollNo) return showError("Enter roll number");
            
            if(confirm(`Are you sure you want to delete student ${rollNo} from Firebase?`)) {
                database.ref(`students/${rollNo}`).remove().then(() => {
                    showSuccess(`Student ${rollNo} deleted from Firebase`);
                    document.getElementById('deleteRollNo').value = '';
                    loadDeleteStudentDropdown();
                    loadAllResults();
                    loadStudentsForMarks();
                });
            }
        }
        
        function deleteSelectedStudent() {
            const select = document.getElementById('deleteStudentSelect');
            const rollNo = select.value;
            if(!rollNo) return showError("Select a student first");
            
            if(confirm(`Are you sure you want to delete student ${rollNo} from Firebase?`)) {
                database.ref(`students/${rollNo}`).remove().then(() => {
                    showSuccess(`Student ${rollNo} deleted from Firebase`);
                    loadDeleteStudentDropdown();
                    loadAllResults();
                    loadStudentsForMarks();
                });
            }
        }
        
        function confirmDeleteAllData() {
            if(confirm("‚ö†Ô∏è DANGER! This will delete ALL data from Firebase - students, subjects, exam date, everything!\n\nThis action cannot be undone!\n\nAre you absolutely sure?")) {
                if(prompt("Type 'DELETE ALL' to confirm:") === "DELETE ALL") {
                    deleteAllData();
                }
            }
        }
        
        function deleteAllData() {
            database.ref().remove().then(() => {
                showSuccess("ALL data deleted from Firebase");
                // Reset local state
                subjects = [];
                currentAdminPassword = "admin123";
                database.ref('adminPassword').set(currentAdminPassword);
                document.getElementById('currentPasswordCode').textContent = currentAdminPassword;
                
                // Reload everything
                loadSubjects();
                loadDeleteStudentDropdown();
                loadAllResults();
                loadStudentsForMarks();
            });
        }
        
        // Change Admin Password
        function changeAdminPassword() {
            const prevPass = document.getElementById('prevPassword').value.trim();
            const newPass = document.getElementById('newPassword').value.trim();
            const confirmPass = document.getElementById('confirmPassword').value.trim();
            
            if(!prevPass || !newPass || !confirmPass) {
                return showError("All fields are required");
            }
            
            if(prevPass !== currentAdminPassword) {
                return showError("Previous password is incorrect");
            }
            
            if(newPass !== confirmPass) {
                return showError("New passwords don't match");
            }
            
            if(newPass.length < 4) {
                return showError("Password must be at least 4 characters");
            }
            
            database.ref('adminPassword').set(newPass).then(() => {
                currentAdminPassword = newPass;
                document.getElementById('currentPasswordCode').textContent = newPass;
                document.getElementById('prevPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                showSuccess("Password changed successfully");
            });
        }
        
        // Load All Results
        function loadAllResults() {
            const filter = document.getElementById('filterClass').value;
            const table = document.getElementById('allResultsTable');
            table.innerHTML = '<tr><td colspan="9">Loading...</td></tr>';
            
            database.ref('students').once('value').then(snapshot => {
                const students = snapshot.val() || {};
                table.innerHTML = '';
                
                Object.keys(students).forEach(rollNo => {
                    const student = students[rollNo];
                    if(filter !== 'all' && student.class !== filter) return;
                    
                    // Calculate marks
                    let totalObtained = 0, totalMaximum = 0;
                    if(student.marks && subjects.length > 0) {
                        subjects.forEach((subject, index) => {
                            const mark = student.marks[index] || 0;
                            totalObtained += parseInt(mark);
                            totalMaximum += subject.total;
                        });
                    }
                    
                    const isAbsent = student.status === 'absent' || !student.marks || student.marks.every(m => m === 0);
                    const positionText = student.position === 1 ? 'ü•á' : student.position === 2 ? 'ü•à' : student.position === 3 ? 'ü•â' : '-';
                    const fineText = student.fine?.amount > 0 ? 
                        (student.fine.paid ? `Rs.${student.fine.amount} (Paid)` : `Rs.${student.fine.amount}`) : 'None';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${positionText}</td>
                        <td>${rollNo}</td>
                        <td>${student.name}</td>
                        <td>${student.class}</td>
                        <td>${isAbsent ? 'Absent' : `${totalObtained}/${totalMaximum}`}</td>
                        <td>${isAbsent ? 'Absent' : 'Present'}</td>
                        <td>${fineText}</td>
                        <td><button class="action-btn btn-primary" onclick="viewStudent('${rollNo}')">View</button></td>
                        <td><button class="action-btn btn-danger" onclick="deleteStudentFromTable('${rollNo}')">Delete</button></td>
                    `;
                    table.appendChild(row);
                });
            });
        }
        
        // Delete Student from Results Table
        function deleteStudentFromTable(rollNo) {
            if(confirm(`Delete student ${rollNo} from Firebase?`)) {
                database.ref(`students/${rollNo}`).remove().then(() => {
                    showSuccess(`Student ${rollNo} deleted from Firebase`);
                    loadAllResults();
                    loadDeleteStudentDropdown();
                    loadStudentsForMarks();
                });
            }
        }
        
        // View Student from Results
        function viewStudent(rollNo) {
            rollNumberInput.value = rollNo;
            checkResult();
        }
        
        // Utility Functions
        function showLoading(show) {
            if(show) {
                document.getElementById('loadingSpinner').classList.remove('hidden');
                resultSection.classList.add('hidden');
            } else {
                document.getElementById('loadingSpinner').classList.add('hidden');
            }
        }
        
        function showError(message) {
            const el = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 5000);
        }
        
        function showSuccess(message) {
            alert(message);
        }
        
        // Check and Add Sample Data
        function checkAndAddSampleData() {
            database.ref('students').once('value').then(snapshot => {
                if(!snapshot.exists() || Object.keys(snapshot.val()).length === 0) {
                    addSampleStudents();
                    // Add default exam date
                    database.ref('examDate').set('2024-06-15');
                    // Add default subjects
                    if(subjects.length === 0) {
                        database.ref('subjects').set([{name: "Quran Recitation", total: 50}]);
                    }
                }
            });
        }
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>